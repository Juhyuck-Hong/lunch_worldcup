<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:type" content="website">
    <meta property="og:title" content="ğŸ•ì ì‹¬ë©”ë‰´ ì›”ë“œì»µğŸš">
    <meta property="og:image" content="https://th.bing.com/th/id/OIG.41MXfTp9uvBpuZtVTsI_?pid=ImgGn">
    <meta property="og:description" content="ì˜¤ëŠ˜ ì ì‹¬ì€ ë­˜ ë¨¹ì„ê¹Œ?">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <title>ğŸ•ì ì‹¬ë©”ë‰´ ì›”ë“œì»µğŸš</title>

    <script>
        $(document).ready(function () {
            showResults()
            $("#game").hide()
            $("#autosave").hide()
            $('#currentRivals').hide()
            $("#chosen").empty()
            $("#dropped").empty()
            $("#rivalsSet").empty()
        })

        // poolì—ì„œ notToPickì„ ì œì™¸í•˜ê³  ëœë¤ìœ¼ë¡œ pickNumê°œì˜ ì´ë¯¸ì§€ë¥¼ ì¶”ì¶œ
        function chooseRandom(pool, pickNum = 2, notToPick = []) {
            let keys = Object.keys(pool)
            let poolSize = keys.length
            let candidate = {}

            if (notToPick.length >= poolSize) {
                // poolì˜ í¬ê¸°ê°€ ì•ˆë½‘ì•„ì•¼í•  ê²ƒê³¼ ê°™ë‹¤ë©´ ë°”ë¡œ ë¹ˆ ë”•ì…”ë„ˆë¦¬ ë°˜í™˜
                return {}
            } else {
                // ë½‘ì„ ê²ƒì´ ìˆë‹¤ë©´,
                let pick = []
                // ë½‘ì€ ê²ƒì´ ë½‘ì„ ê°œìˆ˜ì™€ ê°™ì•„ì§€ë©´ while ì¢…ë£Œ
                while (pick.length < pickNum) {
                    // ëœë¤ìœ¼ë¡œ í•˜ë‚˜ ë½‘ê¸°
                    pickOne_num = Math.floor(Math.random() * poolSize)
                    pickOne = keys[pickOne_num]
                    // ì•ˆë½‘ì•„ì•¼í•  ê²ƒì— ë½‘ì€ê²ƒì´ ìˆë‹¤ë©´ pass
                    if (notToPick.includes(pickOne)) {
                    } else {
                        pick.push(pickOne)
                    }
                    // ê°™ì€ê±¸ ë½‘ì•˜ë‹¤ë©´ ì¤‘ë³µ ì œê±°
                    pick = [...new Set(pick)]
                }
                // ë½‘ì€ ê²ƒë“¤ì„ ë”•ì…”ë„ˆë¦¬ ìë£Œí˜•ìœ¼ë¡œ ì €ì¥í•˜ê³ 
                pick.forEach((key) => {
                    candidate[key] = pool[key]
                })
                // ë°˜í™˜
                return candidate
            }
        }

        // ê²Œì„ ê²°ê³¼ë¥¼ ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
        function showResults() {
            // ì´ë¯¸ ìˆë˜ ê²ƒì„ ì§€ìš°ê³ ,
            $("#results").empty()
            // ì„œë²„ì— ìš”ì²­
            fetch('/results').then((res) => res.json()).then((data) => {
                // ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ rowì— ë„£ê³ 
                let row = data["results"]
                // for ë¬¸ìœ¼ë¡œ card ìƒì„±
                row.forEach((i) => {
                    let name = i["name"]
                    let food = i["result"]
                    let url = foods[food]

                    let temp_html = `
                    <div class="col">
                        <div class="card h-50">
                            <img src="${url}" class="card-img-top" alt="${food}">
                            <div class="card-body">
                            <p class="card-text" style="text-align: center;">${name}ë‹˜ì€ ì ì‹¬ìœ¼ë¡œ ${food}ë¥¼ ì„ íƒ!</p>
                            </div>
                        </div>
                    </div>
                    `
                    // id=resultì— í•˜ë‚˜ì”© ë„£ì–´ì£¼ê¸°
                    $('#results').append(temp_html)
                })
            })
        }

        // game ì‹œì‘ í•¨ìˆ˜
        function gameStart() {
            // ì´ë¦„ ë³€ìˆ˜ ì„ ì–¸, ì €ì¥, ì´ë¦„ ë¯¸ì…ë ¥ ì‹œ ìµëª…ìœ¼ë¡œ ì €ì¥
            let name = $("#name").val() || "ìµëª…"
            // ê°•ìˆ˜ ë³€ìˆ˜ ì„ ì–¸, ì €ì¥
            let rivalsSet = $("#rivalsInput").val()
            $('#currentRivals').append(rivalsSet + "ê°•")

            // ì„ íƒí•œ ê°•ìˆ˜ì— ë§ì¶° pool random ì„ íƒ
            foods = chooseRandom(foods, rivalsSet)
            // id="rivalsSet" divì— ê°’ ì €ì¥
            $('#rivalsSet').append(rivalsSet)

            // ê²Œì„ ì‹œì‘
            playing()
            // ê²Œì„ html ë³´ì´ê¸°
            $('#game').show()
            // ê²Œì„ ì‹œì‘ ë©”ì„¸ì§€
            alert(name + "ë‹˜ì˜ ì ì‹¬ë©”ë‰´ ì›”ë“œì»µ " + rivalsSet + "ê°•ì„ ì‹œì‘í•©ë‹ˆë‹¤!")
            // ê²Œì„ ê²°ê³¼ í˜ì´ì§€ ìˆ¨ê¸°ê¸°
            $('#results').hide()
            // ì´ë¦„ ì…ë ¥, ê°•ìˆ˜ ì„ íƒ, ì‹œì‘ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            $('#middle').hide()
            // í˜„ì¬ ëª‡ê°•ì¸ì§€ í‘œì‹œ íƒœê·¸ ë³´ì´ê²Œ
            $('#currentRivals').show()
        }

        // game ì¢…ë£Œ í•¨ìˆ˜
        function gameTerminate(res) {
            // POST í†µì‹ ì„ ìœ„í•œ ë³´ë‚¼ ìë£Œ FormData ê°ì²´ ì„ ì–¸
            let formData = new FormData()
            // ì´ë¦„ ë³€ìˆ˜ ì„ ì–¸, ì €ì¥, ì´ë¦„ ë¯¸ì…ë ¥ ì‹œ ìµëª…ìœ¼ë¡œ ì €ì¥
            let name = $("#name").val() || "ìµëª…"
            // formDataì— ì´ë¦„ê³¼ ìµœì¢…ì„ íƒí•œ ìŒì‹ì´ë¦„ ì €ì¥
            formData.append("user_name", name)
            formData.append("chosen_name", res)

            // POST í†µì‹ , ì„œë²„ì— formData ë³´ë‚´ê³ , ëŒì•„ì˜¤ëŠ” ë©”ì„¸ì§€ë¥¼ alert í›„ ë©”ì¸í˜ì´ì§€ ì´ë™(ìƒˆë¡œê³ ì¹¨)
            fetch('/results', { method: "POST", body: formData, })
                .then((res) => res.json())
                .then((data) => {
                    console.log(data)
                    alert(data["msg"])
                    window.location.href = "/"
                })
        }

        function playing(event) {

            let chosen = []
            let dropped = []

            // ì´ë¯¸ì§€ í´ë¦­ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ë°›ì•˜ë‹¤ë©´,
            if (event) {

                let click = event.currentTarget
                let droppedAlt = ""
                let droppedId = ""
                let rivalsSet = $('#rivalsSet').text()

                // ì„ íƒí•œ ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ íƒˆë½ ì´ë¯¸ì§€ ì •ë³´ í™•ì¸
                if (click.id == "image_left") {
                    droppedAlt = $('#image_right').attr('alt')
                    droppedId = $('#image_right').attr('id')
                } else {
                    droppedAlt = $('#image_left').attr('alt')
                    droppedId = $('#image_left').attr('id')
                }

                // ìƒˆë¡œ ì„ íƒí•œ ìŒì‹ê³¼ ìƒˆë¡œ íƒˆë½í•œ ìŒì‹ ì €ì¥
                let newChosen = click.alt
                let newDropped = droppedAlt
                // ê¸°ì¡´ ì„ íƒ ìŒì‹ê³¼ íƒˆë½ ìŒì‹ì„ ë³€ìˆ˜ì— ì €ì¥í•˜ê³ ,
                chosen = $('#chosen').text().split(',')
                dropped = $('#dropped').text().split(',')

                // ì„ íƒí•œ ë©”ë‰´ array ì—…ë°ì´íŠ¸
                if (chosen[0]) {
                    chosen.push(newChosen)
                } else {
                    chosen[0] = newChosen
                }
                // í˜¹ì‹œëª¨ë¥¼ ì¤‘ë³µì œê±°
                chosen = [...new Set(chosen)]

                // ë¹„ì„ íƒ ë©”ë‰´ array ì—…ë°ì´íŠ¸
                if (dropped[0]) {
                    dropped.push(newDropped)
                } else {
                    dropped[0] = newDropped
                }
                // í˜¹ì‹œëª¨ë¥¼ ì¤‘ë³µì œê±°
                dropped = [...new Set(dropped)]

                // ì„ íƒê³¼ ë¹„ì„ íƒ array ê¸¸ì´ì˜ í•©ì´ rivalsSetê³¼ ê°™ìœ¼ë©´ í•´ë‹¹ ì°¨ìˆ˜ ì¢…ë£Œ
                // ì„ íƒê³¼ ë¹„ì„ íƒ array ê¸¸ì´ì˜ í•©ì´ rivalsSetê³¼ ê°™ìœ¼ë©´ì„œ ì„ íƒ arrayì˜ ê°œìˆ˜ê°€ 1ê°œë©´ ê²°ìŠ¹ ì¢…ë£Œ
                console.log(chosen.length, dropped.length, rivalsSet)

                if ((chosen.length + dropped.length == rivalsSet) && chosen.length == 1) {
                    alert(`ê²°ìŠ¹ ì¢…ë£Œ! ì ì‹¬ë©”ë‰´ë¡œ ${chosen[0]}ì„ ì„ íƒí•˜ì…¨êµ°ìš”!`)
                    return gameTerminate(chosen[0])
                } else if (chosen.length + dropped.length == rivalsSet) {
                    chosen = []
                    alert(rivalsSet - dropped.length + "ê°• ì‹œì‘!")
                    $('#currentRivals').empty()
                    $('#currentRivals').append(rivalsSet - dropped.length + "ê°•")
                } else {
                    console.log("playing...")
                }

                // ì„ íƒí•œ ë©”ë‰´ html ì—…ë°ì´íŠ¸
                $('#chosen').empty()
                $('#chosen').append(chosen.join(','))

                // ë¹„ì„ íƒ ë©”ë‰´ html ì—…ë°ì´íŠ¸
                $('#dropped').empty()
                $('#dropped').append(dropped.join(','))
            }

            // ìƒˆë¡œìš´ ë©”ë‰´ 2ê°œ ì¶”ì¶œ {name1: url1, name2: url2}
            candidate = chooseRandom(foods, 2, [...chosen, ...dropped])

            nameList = Object.keys(candidate)
            let img1Name = nameList[0]
            let img1Url = candidate[nameList[0]]
            let img2Name = nameList[1]
            let img2Url = candidate[nameList[1]]

            $('#game').empty()

            // í‘œì‹œí•  HTML íƒœê·¸ ì‘ì„±
            let gameHtml = `
                <div class="col">
                    <div class="card">
                        <div class="card-body">
                            <h5 id="name_left" class="card-title" style="text-align: center;">${img1Name}</h5>
                            <img id="image_left" onclick="playing(event)" src="${img1Url}" class="card-img-top" alt="${img1Name}" style="width: 100%; height: auto;">
                        </div>
                    </div>
                </div>
                    <div class="col">
                    <div class="card">
                        <div class="card-body">
                            <h5 id="name_right" class="card-title" style="text-align: center;">${img2Name}</h5>
                            <img id="image_right" onclick="playing(event)" src="${img2Url}" class="card-img-top" alt="${img2Name}" style="width: 100%; height: auto;">
                        </div>
                    </div>
                </div>
            `
            // idì— ì¶”ê°€
            $('#game').append(gameHtml)
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sunflower:wght@300&display=swap');

        * {
            font-family: 'Sunflower', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .top {
            width: 100%;
            height: 200px;
            background-color: darkorange;
            background-position: center;
            background-size: cover;
            margin: 20px auto 20px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .top>h1 {
            padding-bottom: 0px;
            color: white;
        }

        .nameAndGo {
            width: 400px;
            height: 55px;
            margin: 20px auto;
            padding: 5px;
            box-shadow: 0px 0px 1px 0px grey;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
        }

        .form {
            border-radius: 5px;
            border: 2px solid #ddd;
            width: 200px;
            padding: 1px;
        }

        .test {
            background-color: green;
        }

        .bottom {
            width: 90%;
            margin: 0px auto;
        }

        .nameAndGo>input {
            width: 70%;
        }

        .card-img-top {
            transition: transform 0.1s ease;
        }

        .card-img-top:hover {
            opacity: 0.95;
            transform: scale(1.01);
        }
    </style>

</head>

<body>
    <div class="top">
        <h1>ğŸ•ì ì‹¬ë©”ë‰´ ì›”ë“œì»µğŸš</h1>
        <p id="currentRivals"></p>
    </div>
    <div class="middle" id="middle">
        <div class="nameAndGo">
            <input id="name" class="form-control" type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”." style="max-width: 150px;" />
            <button class="btn btn-primary" onclick=gameStart()>ì‹œì‘!</button>
            <select class="form-select" id="rivalsInput" style="max-width: 150px;">
                <option selected value="32">32ê°•ë¶€í„°</option>
                <option value="16">16ê°•ë¶€í„°</option>
                <option value="8">8ê°•ë¶€í„°</option>
                <option value="4">4ê°•ë¶€í„°</option>
            </select>
        </div>
    </div>

    <div class="bottom">
        <div class="row row-cols-1 row-cols-md-2 g-4" id="game">
        </div>

        <div class="row row-cols-1 row-cols-md-4 g-4" id="results">
        </div>
    </div>

    <div id="autosave">
        <div id="chosen"></div>
        <div id="dropped"></div>
        <div id="rivalsSet"></div>
        <script>
            var foods = { 'ê°ìíƒ•': 'https://health.chosun.com/site/data/img_dir/2021/01/26/2021012602424_0.jpg', 'ê³ ë“±ì–´êµ¬ì´': 'https://recipe1.ezmember.co.kr/cache/recipe/2019/10/14/eafe70f3fbb6b6cdfbc8f8a1283f0c011.jpg', 'ê¹€ë°¥': 'https://upload.wikimedia.org/wikipedia/commons/0/0e/Gimbap_%28pixabay%29.jpg', 'ëˆê¹ŒìŠ¤': 'https://cdn.clien.net/web/api/file/F01/7262338/14b0f13e08ca3f.jpg', 'ëˆë¶€ë¦¬': 'https://rimage.gnst.jp/livejapan.com/public/article/detail/a/00/05/a0005066/img/ko/a0005066_main.jpg', 'ë–¡ë³¶ì´': 'https://funshop.akamaized.net/products/0000098549/vs_image800.jpg', 'ë¼ë©´': 'https://img.insight.co.kr/static/2017/12/13/2000/9mg762010d3cw399d659.jpg', 'ë§Œë‘êµ­': 'https://recipe1.ezmember.co.kr/cache/recipe/2021/02/06/d0d6c059f08600bb14b23ed917b064141.jpg', 'ë°±ë°˜': 'https://cloudfront-ap-northeast-1.images.arcpublishing.com/chosun/P4YBXVVUCMS3P7KDH2IKMGELC4.jpg', 'ë²„ê±°': 'https://cloudfront-ap-northeast-1.images.arcpublishing.com/chosunbiz/T76RHKX27GOS5BHD6LCD5W6DNQ.jpg', 'ë³¶ìŒë°¥': 'https://i.ytimg.com/vi/S_glK_h78xI/maxresdefault.jpg', 'ë¶ˆê³ ê¸°': 'https://recipe1.ezmember.co.kr/cache/recipe/2019/03/03/11baafbe81803965b17c3ab42a5992cb1.jpg', 'ë¹„ë¹”ë°¥': 'https://i.pinimg.com/originals/d5/b3/ba/d5b3ba6572223074aed75a6daf945d5a.jpg', 'ì‚¼ê²¹ì‚´': 'https://mp-seoul-image-production-s3.mangoplate.com/mango_pick/uker6u9xhkr1m8.jpg', 'ìƒŒë“œìœ„ì¹˜': 'https://recipe1.ezmember.co.kr/cache/recipe/2021/12/23/8f1022f46829257d51b21cf1d08d72241.jpg', 'ìƒëŸ¬ë“œ': 'https://src.hidoc.co.kr/image/lib/2021/2/17/1613545788294_0.jpg', 'ìƒ¤ë¸Œìƒ¤ë¸Œ': 'https://www.elandretail.com/upload/20170828170024_0.jpg', 'ìˆ˜ì œë¹„': 'https://recipe1.ezmember.co.kr/cache/recipe/2016/07/28/f563617e4c5f769e84377e0ee4668e621.jpg', 'ìŠ¤í…Œì´í¬': 'https://recipe1.ezmember.co.kr/cache/recipe/2017/07/09/6741acc7f6bf0f7d04245851fb365c311.jpg', 'ìŒ€êµ­ìˆ˜': 'https://i.pinimg.com/originals/bd/7f/a4/bd7fa4ec8ea81665e4608df059d940be.jpg', 'ì•¼ì±„ë³¶ìŒ': 'https://recipe1.ezmember.co.kr/cache/recipe/2019/04/07/d50dbf8eb8668092c11828dc9d39260d1.jpg', 'ì§œì¥ë©´': 'https://recipe1.ezmember.co.kr/cache/recipe/2021/10/26/8f82be9c22ec2f4f9ab25363cc611b141.jpg', 'ì§¬ë½•': 'https://recipe1.ezmember.co.kr/cache/recipe/2017/06/19/2756808e5603db7a18c4f5ee9a699ee41.jpg', 'ì´ˆë°¥': 'https://watermark.lovepik.com/photo/50053/3820.jpg_wh1200.jpg', 'ì¹˜í‚¨ í…ë”': 'https://recipe1.ezmember.co.kr/cache/recipe/2017/12/19/e0df7cee9917c1e0bb31bd9645d0d3791.jpg', 'ì½©êµ­ìˆ˜': 'https://src.hidoc.co.kr/image/lib/2019/7/25/20190725103200889_0.jpg', 'íƒ€ì½”': 'https://recipe1.ezmember.co.kr/cache/recipe/2020/06/17/41f36e22404c059d9750b8eabcddb77f1.jpg', 'íƒ•ìˆ˜ìœ¡': 'https://homecuisine.co.kr/files/attach/images/142/073/002/99b983892094b5c6d2fc3736e15da7d1.JPG', 'íŒŒë‹ˆë‹ˆ': 'https://www.newiki.net/w/images/thumb/f/ff/Panini.jpg/1200px-Panini.jpg', 'íŒŒìŠ¤íƒ€': 'https://recipe1.ezmember.co.kr/cache/recipe/2019/04/01/f8b3042c80a214dd7cc60fa2027cdc9d1.jpg', 'í”¼ì': 'https://recipe1.ezmember.co.kr/cache/recipe/2022/08/04/8f6d10f605eb2f763bf8c0a94947c81f1.jpg', 'í–„ë²„ê±° ìŠ¤í…Œì´í¬': 'https://recipe1.ezmember.co.kr/cache/recipe/2015/09/22/6308008dd029eb6235a02d7f339e5796.jpg' }        
        </script>
    </div>
</body>

</html>